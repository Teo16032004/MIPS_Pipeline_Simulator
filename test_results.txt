??????????????????????????????????????????????????????????????
?     MIPS PIPELINE SIMULATOR - HAZARD DETECTION TESTS      ?
??????????????????????????????????????????????????????????????


============================================================
TEST 1: Data Hazards with Forwarding
============================================================
This test demonstrates RAW (Read After Write) hazards
that are resolved using forwarding paths.

=== Starting MIPS Pipeline Simulation ===


--- Cycle 1 ---
IF: Fetched ADD at PC=0

Pipeline State:
  IF/ID:  ADD
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 2 ---
ID: Decoded ADD
IF: Fetched SUB at PC=1

Pipeline State:
  IF/ID:  SUB
  ID/EX:  ADD
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 3 ---
EX: ADD result=30
ID: Decoded SUB
IF: Fetched ADD at PC=2

Pipeline State:
  IF/ID:  ADD
  ID/EX:  SUB
  EX/MEM: ADD
  MEM/WB: ADD

--- Cycle 4 ---
WB: Write 30 to $3
  [HAZARD SOLVED] Forwarding $3: 0 -> 30
EX: SUB result=20
ID: Decoded ADD
IF: Fetched AND at PC=3

Pipeline State:
  IF/ID:  AND
  ID/EX:  ADD
  EX/MEM: SUB
  MEM/WB: SUB

--- Cycle 5 ---
WB: Write 20 to $4
  [HAZARD SOLVED] Forwarding $4: 0 -> 20
EX: ADD result=50
ID: Decoded AND

Pipeline State:
  IF/ID:  empty
  ID/EX:  AND
  EX/MEM: ADD
  MEM/WB: ADD

--- Cycle 6 ---
WB: Write 50 to $5
  [HAZARD SOLVED] Forwarding $5: 0 -> 50
EX: AND result=16

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: AND
  MEM/WB: AND

--- Cycle 7 ---
WB: Write 16 to $6

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

=== Simulation Complete ===
Total cycles: 7
Total stalls: 0

=== Register File ===
$1 : 10 (0x0000000A)
$2 : 20 (0x00000014)
$3 : 30 (0x0000001E)
$4 : 20 (0x00000014)
$5 : 50 (0x00000032)
$6 : 16 (0x00000010)

=== Memory Contents ===

? Expected: Forwarding should handle all hazards without stalls
? Verify: $3=30, $4=20, $5=50, $6=16

============================================================
TEST 2: Load-Use Hazard (Requires Stall)
============================================================
This test demonstrates load-use hazards that require
pipeline stalls because data isn't available in time.

=== Starting MIPS Pipeline Simulation ===


--- Cycle 1 ---
IF: Fetched LW at PC=0

Pipeline State:
  IF/ID:  LW
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 2 ---
ID: Decoded LW
IF: Fetched ADD at PC=1

Pipeline State:
  IF/ID:  ADD
  ID/EX:  LW
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 3 ---
EX: LW result=0
MEM: Load from address 0 = 100
  [HAZARD DETECTED] Load-Use on $2: LW -> ADD
ID: STALL detected (Load-Use Hazard)
IF: Fetched ADD at PC=1

Pipeline State:
  IF/ID:  ADD
  ID/EX:  empty
  EX/MEM: LW
  MEM/WB: LW

--- Cycle 4 ---
WB: Write 100 to $2
ID: Decoded ADD
IF: Fetched LW at PC=2

Pipeline State:
  IF/ID:  LW
  ID/EX:  ADD
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 5 ---
EX: ADD result=100
ID: Decoded LW
IF: Fetched SUB at PC=3

Pipeline State:
  IF/ID:  SUB
  ID/EX:  LW
  EX/MEM: ADD
  MEM/WB: ADD

--- Cycle 6 ---
WB: Write 100 to $3
EX: LW result=4
MEM: Load from address 4 = 200
  [HAZARD DETECTED] Load-Use on $4: LW -> SUB
ID: STALL detected (Load-Use Hazard)
IF: Fetched SUB at PC=3

Pipeline State:
  IF/ID:  SUB
  ID/EX:  empty
  EX/MEM: LW
  MEM/WB: LW

--- Cycle 7 ---
WB: Write 200 to $4
ID: Decoded SUB

Pipeline State:
  IF/ID:  empty
  ID/EX:  SUB
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 8 ---
EX: SUB result=100

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: SUB
  MEM/WB: SUB

--- Cycle 9 ---
WB: Write 100 to $5

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

=== Simulation Complete ===
Total cycles: 9
Total stalls: 2

=== Register File ===
$2 : 100 (0x00000064)
$3 : 100 (0x00000064)
$4 : 200 (0x000000C8)
$5 : 100 (0x00000064)

=== Memory Contents ===
Addr 0: 100 (0x00000064)
Addr 4: 200 (0x000000C8)

? Expected: 2 stalls (one for each load-use hazard)
? Verify: $2=100, $3=100, $4=200, $5=100
? Stall count should be: 2

============================================================
TEST 3: Complex Hazards (Mixed Types)
============================================================
This test combines load-use hazards and data hazards.

=== Starting MIPS Pipeline Simulation ===


--- Cycle 1 ---
IF: Fetched ADD at PC=0

Pipeline State:
  IF/ID:  ADD
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 2 ---
ID: Decoded ADD
IF: Fetched ADDI at PC=1

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  ADD
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 3 ---
EX: ADD result=15
ID: Decoded ADDI
IF: Fetched LW at PC=2

Pipeline State:
  IF/ID:  LW
  ID/EX:  ADDI
  EX/MEM: ADD
  MEM/WB: ADD

--- Cycle 4 ---
WB: Write 15 to $3
EX: ADDI result=20
ID: Decoded LW
IF: Fetched ADD at PC=3

Pipeline State:
  IF/ID:  ADD
  ID/EX:  LW
  EX/MEM: ADDI
  MEM/WB: ADDI

--- Cycle 5 ---
WB: Write 20 to $4
  [HAZARD SOLVED] Forwarding $4: 0 -> 20
EX: LW result=20
MEM: Load from address 20 = 50
  [HAZARD DETECTED] Load-Use on $5: LW -> ADD
ID: STALL detected (Load-Use Hazard)
IF: Fetched ADD at PC=3

Pipeline State:
  IF/ID:  ADD
  ID/EX:  empty
  EX/MEM: LW
  MEM/WB: LW

--- Cycle 6 ---
WB: Write 50 to $5
ID: Decoded ADD
IF: Fetched SLL at PC=4

Pipeline State:
  IF/ID:  SLL
  ID/EX:  ADD
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 7 ---
EX: ADD result=65
ID: Decoded SLL
IF: Fetched SUB at PC=5

Pipeline State:
  IF/ID:  SUB
  ID/EX:  SLL
  EX/MEM: ADD
  MEM/WB: ADD

--- Cycle 8 ---
WB: Write 65 to $6
  [HAZARD SOLVED] Forwarding $6: 0 -> 65
EX: SLL result=130
ID: Decoded SUB

Pipeline State:
  IF/ID:  empty
  ID/EX:  SUB
  EX/MEM: SLL
  MEM/WB: SLL

--- Cycle 9 ---
WB: Write 130 to $7
  [HAZARD SOLVED] Forwarding $7: 0 -> 130
EX: SUB result=80

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: SUB
  MEM/WB: SUB

--- Cycle 10 ---
WB: Write 80 to $8

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

=== Simulation Complete ===
Total cycles: 10
Total stalls: 1

=== Register File ===
$1 : 5 (0x00000005)
$2 : 10 (0x0000000A)
$3 : 15 (0x0000000F)
$4 : 20 (0x00000014)
$5 : 50 (0x00000032)
$6 : 65 (0x00000041)
$7 : 130 (0x00000082)
$8 : 80 (0x00000050)

=== Memory Contents ===
Addr 20: 50 (0x00000032)

? Expected: 1 stall (for load-use hazard on $5)
? Verify: $3=15, $4=20, $5=50, $6=65, $7=130, $8=80
? Stall count: 1

============================================================
TEST 5: BEQ Control Hazard
============================================================
This test demonstrates control hazards with BEQ instruction.

=== Starting MIPS Pipeline Simulation ===


--- Cycle 1 ---
IF: Fetched ADDI at PC=0

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 2 ---
ID: Decoded ADDI
IF: Fetched ADDI at PC=1

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  ADDI
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 3 ---
EX: ADDI result=5
ID: Decoded ADDI
IF: Fetched BEQ at PC=2

Pipeline State:
  IF/ID:  BEQ
  ID/EX:  ADDI
  EX/MEM: ADDI
  MEM/WB: ADDI

--- Cycle 4 ---
WB: Write 5 to $1
EX: ADDI result=5
ID: Decoded BEQ
IF: Fetched ADDI at PC=3

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  BEQ
  EX/MEM: ADDI
  MEM/WB: ADDI

--- Cycle 5 ---
WB: Write 5 to $2
  [HAZARD SOLVED] Forwarding $2: 0 -> 5
  [CONTROL HAZARD] Branch taken - flushing pipeline
EX: Branch taken to PC=4
EX: BEQ result=0
IF: Fetched ADDI at PC=4

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  empty
  EX/MEM: BEQ
  MEM/WB: BEQ

--- Cycle 6 ---
ID: Decoded ADDI
IF: Fetched ADDI at PC=5

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  ADDI
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 7 ---
EX: ADDI result=200
ID: Decoded ADDI

Pipeline State:
  IF/ID:  empty
  ID/EX:  ADDI
  EX/MEM: ADDI
  MEM/WB: ADDI

--- Cycle 8 ---
WB: Write 200 to $4
EX: ADDI result=999

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: ADDI
  MEM/WB: ADDI

--- Cycle 9 ---
WB: Write 999 to $5

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

=== Simulation Complete ===
Total cycles: 9
Total stalls: 0

=== Register File ===
$1 : 5 (0x00000005)
$2 : 5 (0x00000005)
$4 : 200 (0x000000C8)
$5 : 999 (0x000003E7)

=== Memory Contents ===

? Expected: BEQ should branch to index 4 (skip instruction at index 3)
? Verify: $1=5, $2=5, $3=0, $4=200, $5=999

============================================================
TEST 6: J (Jump) Control Hazard
============================================================
This test demonstrates control hazards with J instruction.

=== Starting MIPS Pipeline Simulation ===


--- Cycle 1 ---
IF: Fetched ADDI at PC=0

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 2 ---
ID: Decoded ADDI
IF: Fetched J at PC=1

Pipeline State:
  IF/ID:  J
  ID/EX:  ADDI
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 3 ---
EX: ADDI result=10
ID: Decoded J
IF: Fetched ADDI at PC=2

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  J
  EX/MEM: ADDI
  MEM/WB: ADDI

--- Cycle 4 ---
WB: Write 10 to $1
  [CONTROL HAZARD] Jump taken - flushing pipeline
EX: Jump to PC=3
EX: J result=0
IF: Fetched ADDI at PC=3

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  empty
  EX/MEM: J
  MEM/WB: J

--- Cycle 5 ---
ID: Decoded ADDI
IF: Fetched ADDI at PC=4

Pipeline State:
  IF/ID:  ADDI
  ID/EX:  ADDI
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 6 ---
EX: ADDI result=30
ID: Decoded ADDI

Pipeline State:
  IF/ID:  empty
  ID/EX:  ADDI
  EX/MEM: ADDI
  MEM/WB: ADDI

--- Cycle 7 ---
WB: Write 30 to $3
EX: ADDI result=40

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: ADDI
  MEM/WB: ADDI

--- Cycle 8 ---
WB: Write 40 to $4

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

=== Simulation Complete ===
Total cycles: 8
Total stalls: 0

=== Register File ===
$1 : 10 (0x0000000A)
$3 : 30 (0x0000001E)
$4 : 40 (0x00000028)

=== Memory Contents ===

? Expected: J should jump to index 3 (skip instruction at index 2)
? Verify: $1=10, $2=0, $3=30, $4=40

============================================================
TEST 4: Simulation WITHOUT Hazard Detection
============================================================
This test shows incorrect results when hazard detection
and forwarding are disabled (for educational comparison).

=== Starting MIPS Pipeline Simulation ===


--- Cycle 1 ---
IF: Fetched ADD at PC=0

Pipeline State:
  IF/ID:  ADD
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 2 ---
ID: Decoded ADD
IF: Fetched SUB at PC=1

Pipeline State:
  IF/ID:  SUB
  ID/EX:  ADD
  EX/MEM: empty
  MEM/WB: empty

--- Cycle 3 ---
EX: ADD result=30
ID: Decoded SUB

Pipeline State:
  IF/ID:  empty
  ID/EX:  SUB
  EX/MEM: ADD
  MEM/WB: ADD

--- Cycle 4 ---
WB: Write 30 to $3
EX: SUB result=-10

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: SUB
  MEM/WB: SUB

--- Cycle 5 ---
WB: Write -10 to $4

Pipeline State:
  IF/ID:  empty
  ID/EX:  empty
  EX/MEM: empty
  MEM/WB: empty

=== Simulation Complete ===
Total cycles: 5
Total stalls: 0

=== Register File ===
$1 : 10 (0x0000000A)
$2 : 20 (0x00000014)
$3 : 30 (0x0000001E)
$4 : -10 (0xFFFFFFF6)

=== Memory Contents ===

? WARNING: Results will be INCORRECT without hazard handling!
? $4 will likely be wrong (using old $3 value = 0)
? This demonstrates why hazard detection is essential!
